<script type="text/discourse-plugin" version="0.8">
  api.decorateWidget('header-buttons:before', function (helper) {
    if (!settings.custom_header_items) {
      return
    }

    if (!settings.header_items || !settings.subheader_items) {
      return
    }

    var headerItems = settings.header_items.split('|').map(function (item) {
      var itemList = item.split(';')
      var href =
        itemList.length === 1 || itemList[1] === '' ? null : itemList[1]

      if (href) {
        return {
          name: itemList[0],
          href: href,
        }
      } else {
        return {
          name: itemList[0],
        }
      }
    })

    var subheaderItems = settings.subheader_items
      .split('|')
      .map(function (items) {
        var itemsList = items.startsWith('#')
          ? []
          : items.split(',').map(function (item) {
              var itemList = item.split(';')

              return {
                name: itemList[0],
                href: itemList[1],
              }
            })

        return itemsList
      })
      .forEach(function (items, i) {
        if (items.length !== 0) {
          headerItems[i].dropdown = true
          headerItems[i].dropdownItems = items
        }
      })

    var navData = headerItems

    var h = helper.h

    return h(
      'nav.asktug-nav',
      navData.map(function (d) {
        var withDropdown = d.dropdown

        if (withDropdown) {
          return h(
            'div.nav-item.with-dropdown',
            [
              h(
                'a',
                {
                  href: '#',
                },
                d.name
              ),
            ].concat(
              h(
                'div.dropdown',
                d.dropdownItems.map(function (i) {
                  return h(
                    'a.dropdown-item',
                    {
                      href: i.href,
                      target: '_blank',
                    },
                    i.name
                  )
                })
              )
            )
          )
        } else {
          return h(
            'div.nav-item',
            h(
              'a',
              {
                href: d.href,
                target: '_blank',
              },
              d.name
            )
          )
        }
      })
    )
  })
</script>

<script type="text/discourse-plugin" version="0.8">
  window.checkIsLogin = function () {
    return {
      currentUser: Discourse.User.current(),
      checkIsLoginConfirmMessage: settings.check_is_login_confirm_message,
      checkIsLoginConfirmLabel: settings.check_is_login_confirm_label,
      checkIsLoginCancelLabel: settings.check_is_login_cancel_label,
      checkIsLoginRedirect: settings.check_is_login_redirect
    }
  }
</script>
